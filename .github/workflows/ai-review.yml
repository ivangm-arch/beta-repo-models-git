name: IA Analisis
on: [push, pull_request]
jobs:
  review:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - run: |
          TOKEN='${{ secrets.GITHUB_TOKEN }}'
          CODIGO=$(cat src/example.js || echo "no archivo")
          curl -s -X POST https://models.inference.ai.azure.com/chat/completions \
            -H "Authorization: Bearer $TOKEN" \
            -d "{\"model\":\"gpt-4o-mini\",\"messages\":[{\"role\":\"user\",\"content\":\"Analiza: $CODIGO\"}]}" | \
          jq -r '.choices[0].message.content' | \
          curl -X POST "https://api.github.com/repos/${{ github.repository }}/issues/${{ github.event.pull_request.number || 1 }}/comments" \
            -H "Authorization: Bearer $TOKEN" \
            -d "{\"body\":\"IA: $(cat)\"}"
