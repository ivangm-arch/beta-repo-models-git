name: ðŸ¤– AI Code Review & PR Analysis

on:
  pull_request:
    types: [opened, synchronize, reopened]

permissions:
  contents: read
  pull-requests: write
  models: read

jobs:
  analyze:
    runs-on: ubuntu-latest
    
    steps:
      # 1. Checkout del cÃ³digo
      - name: Checkout
        uses: actions/checkout@v4

      # 2. LEER src/example.js â†’ output para el modelo
      - name: Read code to analyze
        id: code
        run: |
          CODE=$(cat src/example.js 2>/dev/null || echo "CÃ³digo src/example.js no encontrado o error")
          echo "content<<EOF" >> $GITHUB_OUTPUT
          echo "$CODE" >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT

      # 3. Obtener contexto del PR
      - name: Get PR info
        id: pr
        uses: actions/github-script@v7
        with:
          script: |
            const pr = context.payload.pull_request;
            core.setOutput('title', pr.title);
            core.setOutput('body', pr.body || '(sin descripciÃ³n)');
            core.setOutput('author', pr.user.login);

      # 4. LLAMAR GITHub MODELS API
      - name: ðŸ”® Call GitHub Models API
        id: models
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # CÃ³digo que analiza (src/example.js)
          CODE="${{ steps.code.outputs.content }}"
          
          # Datos del PR
          TITLE="${{ steps.pr.outputs.title }}"
          BODY="${{ steps.pr.outputs.body }}"
          
          # Prompt completo
          PROMPT="Eres revisor automÃ¡tico para estudiantes.

**CÃ“DIGO ANALIZADO (src/example.js):**
\`\`\`javascript
$CODE
\`\`\`

**PR INFO:**
TÃ­tulo: '$TITLE'
Autor: '${{ steps.pr.outputs.author }}'
